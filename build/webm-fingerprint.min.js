var BitArray=function(t,r){if(this.values=[],r){if(r=r.slice(/^0x/.exec(r)?2:0),4*r.length>this.length)throw"Hex value is too large for this bit array.";if(4*r.length<this.length)for(;4*r.length<this.length;)r="0"+r;for(var e=0;e<r.length/8;e++){var n=r.slice(8*e,8*e+8);this.values[e]=parseInt(n,16)}}else for(var e=0;e<Math.ceil(t/32);e+=1)this.values[e]=0};BitArray.prototype.size=function(){return 32*this.values.length},BitArray.prototype.set=function(t,r){var e=Math.floor(t/32);return r?this.values[e]|=1<<t-32*e:this.values[e]&=~(1<<t-32*e),this},BitArray.prototype.toggle=function(t){var r=Math.floor(t/32);return this.values[r]^=1<<t-32*r,this},BitArray.prototype.get=function(t){var r=Math.floor(t/32);return!!(this.values[r]&1<<t-32*r)},BitArray.prototype.reset=function(){return this.values=[],this},BitArray.prototype.copy=function(){var t=new BitArray;return t.length=this.length,t.values=[].concat(this.values),t},BitArray.prototype.equals=function(t){return this.values.length===t.values.length&&this.values.every(function(r,e){return r===t.values[e]})},BitArray.prototype.toJSON=function(){return JSON.stringify(this.values)},BitArray.prototype.toString=function(){return this.toArray().map(function(t){return t?"1":"0"}).join("")},BitArray.prototype.toBinaryString=function(){return this.toArray().map(function(t){return t?"1":"0"}).reverse().join("")},BitArray.prototype.toHexString=function(){for(var t=[],r=0;r<this.values.length;r+=1)t.push(("00000000"+(this.values[r]>>>0).toString(16)).slice(-8));return t.join("")},BitArray.prototype.toArray=function(){for(var t=[],r=0;r<32*this.values.length;r+=1)t.push(this.get(r));return t},BitArray.prototype.count=function(){var t=0;return this.values.forEach(function(r){r-=r>>1&1431655765,r=(858993459&r)+(r>>2&858993459),r+=r>>4,r&=252645135,t+=16843009*r>>24}),t},BitArray.prototype.not=function(){return this.values=this.values.map(function(t){return~t}),this},BitArray.prototype.or=function(t){if(this.values.length!==t.values.length)throw"Arguments must be of the same length.";return this.values=this.values.map(function(r,e){return r|t.values[e]}),this},BitArray.prototype.and=function(t){if(this.values.length!==t.values.length)throw"Arguments must be of the same length.";return this.values=this.values.map(function(r,e){return r&t.values[e]}),this},BitArray.prototype.xor=function(t){if(this.values.length!==t.values.length)throw"Arguments must be of the same length.";return this.values=this.values.map(function(r,e){return r^t.values[e]}),this};var KeyframeExtractor=function(){function t(t){for(var r=PerceptualHash.createImage(t,t.videoWidth,t.videoHeight,!0),e={},n=0;255>n;n++)e[n]=0;return r.forEach(function(t){e[t]++}),Object.keys(e).map(function(t){return e[t]})}function r(r){var e=t(r),n=e.map(function(t){return t/e.length}).filter(function(t){return t>0});return n.map(function(t){return t*(Math.log(t)/Math.LN2)}).reduce(function(t,r){return t+r})}function e(t){for(var r=[0],e=1;e<t.length;e++)r.push(Math.abs(t[e]-t[e-1]));for(var n=-1,a=0,e=0;e<t.length;e++)(-1==n||a<r[e])&&(n=e,a=r[e]);return n}return{calculateImageEntropy:r,createHistogram:t,findShotBoundary:e}}(),PerceptualHash=function(){function t(t,r,e,n){void 0===n&&(n=!0);var a=document.createElement("canvas");a.width=r,a.height=e;var i=a.getContext("2d");i.drawImage(t,0,0,r,e);var o=i.getImageData(0,0,r,e).data;if(!n)return o;for(var u=[],s=0;e*r*4>s;s+=4){var h=(o[s]+o[s+1]+o[s+2])/3;h*=255/o[s+3],u.push(Math.floor(h))}return u}function r(r){for(var e=t(r,8,8),n=e.reduce(function(t,r){return t+r}),a=n/e.length,i=new BitArray(64),o=0;64>o;o++)i.set(o,e[o]>=a);return i.toHexString()}function e(r){for(var e=t(r,9,8),n=new BitArray(64),a=0;64>a;a++)n.set(a,e[a]<e[a+1]);return n.toHexString()}function n(r){for(var e=t(r,16,16,!1),n=0,a=0,i=0,o=0;o<e.length-3;o+=3)n+=e[o]||0,a+=e[o-1]||0,i+=e[o-2]||0;for(var u=[Math.floor(n/e.length),Math.floor(a/e.length),Math.floor(i/e.length)],s=0,h={},o=0;o<e.length-3;o+=3){var l=0;l+=Math.abs(e[o]-u[0]),l+=Math.abs(e[o+1]-u[1]),l+=Math.abs(e[o+2]-u[2]),s+=l;var f=e[o]+","+e[o+1]+","+e[o+2];h[f]=!0}var c=Object.keys(h).length;return c+s}return{aHash:r,dHash:e,cHash:n,createImage:t}}(),WebMFingerprint=function(){function t(t,r,e){function n(){if(!l)return l=!0,a();if(f.length>=24||t.currentTime==t.duration){l=!1;var r=KeyframeExtractor.findShotBoundary(f);return t.currentTime=Math.floor(t.currentTime)-f.length*h+r*h,void(f=[])}f.push(KeyframeExtractor.calculateImageEntropy(t)),t.currentTime+=h}function a(){if(i){var r=PerceptualHash.aHash(t);-1==s.indexOf(r)&&s.push(r)}if(o){var r=PerceptualHash.dHash(t);-1==u.indexOf(r)&&u.push(r)}return t.duration-t.currentTime>1?void(t.currentTime=Math.floor(t.currentTime)+1):(t.removeEventListener("seeked",n),e(null,{aHashes:s,dHashes:u}))}var i=!0,o=!0;r.aHash===!1&&(i=!1),r.dHash===!1&&(o=!1),t.currentTime=0;var u=[],s=[],h=1/(r.fps||24),l=!0,f=[];t.addEventListener("seeked",n),n()}function r(r,e){var n={};if(void 0==r.nodeName){var n=r;if(r=n.element,!n.element)return e("No element specified.")}var a=r.duration;return 1/0==a?e("Cannot fingerprint streaming media."):void 0==a||0/0==a?e("Video length not available."):0==a||0==r.readyState?r.addEventListener("loadedmetadata",function(){t(r,n,e)}):void t(r,n,e)}return r}();"undefined"!=typeof module&&module.exports&&(module.exports=WebMFingerprint);
//# sourceMappingURL=webm-fingerprint.min.js.map